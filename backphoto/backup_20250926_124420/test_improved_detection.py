#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
æ”¹è¿›çš„åè„‘å‹ºæ£€æµ‹æµ‹è¯•ç¨‹åº
- ä¸æ‹æ­£è„¸ï¼Œåªæ‹åè„‘å‹º
- æ‹ç…§æ—¶æ’­æ”¾å£°éŸ³æç¤º
- å®æ—¶æ˜¾ç¤ºæ£€æµ‹çŠ¶æ€
"""

import sys
import os
from back_detector import BackDetector

def test_improved_detection():
    """æµ‹è¯•æ”¹è¿›çš„åè„‘å‹ºæ£€æµ‹åŠŸèƒ½"""
    print("=" * 60)
    print("           æ”¹è¿›çš„åè„‘å‹ºæ£€æµ‹æµ‹è¯•")
    print("=" * 60)
    print("åŠŸèƒ½ç‰¹ç‚¹ï¼š")
    print("âœ… åªæ‹åè„‘å‹ºï¼Œä¸æ‹æ­£è„¸")
    print("âœ… æ‹ç…§æ—¶æ’­æ”¾å£°éŸ³æç¤º")
    print("âœ… å®æ—¶æ˜¾ç¤ºæ£€æµ‹çŠ¶æ€")
    print("=" * 60)
    
    detector = BackDetector()
    
    # æ£€æŸ¥æ‘„åƒå¤´
    print("\n1. æ£€æŸ¥æ‘„åƒå¤´...")
    if not detector.start_camera():
        print("âŒ æ‘„åƒå¤´å¯åŠ¨å¤±è´¥")
        print("è¯·æ£€æŸ¥ï¼š")
        print("- æ‘„åƒå¤´æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨")
        print("- æ‘„åƒå¤´æƒé™æ˜¯å¦å·²å¼€å¯")
        print("- æ‘„åƒå¤´è®¾å¤‡æ˜¯å¦æ­£å¸¸")
        return False
    
    print("âœ… æ‘„åƒå¤´å¯åŠ¨æˆåŠŸ")
    
    # å¼€å§‹æ£€æµ‹
    print("\n2. å¼€å§‹åè„‘å‹ºæ£€æµ‹...")
    print("ğŸ“‹ ä½¿ç”¨è¯´æ˜ï¼š")
    print("   - å°†åè„‘å‹ºå¯¹å‡†æ‘„åƒå¤´")
    print("   - ç³»ç»Ÿä¼šæ£€æµ‹æ­£è„¸ï¼Œæ£€æµ‹åˆ°æ­£è„¸æ—¶ä¸æ‹ç…§")
    print("   - åªæœ‰æ£€æµ‹åˆ°åè„‘å‹ºæ—¶æ‰ä¼šæ‹ç…§")
    print("   - æ‹ç…§æ—¶ä¼šæ’­æ”¾å£°éŸ³æç¤º")
    print("   - æŒ‰ESCé”®åœæ­¢æ£€æµ‹")
    print("\nğŸ¯ å¼€å§‹æ£€æµ‹...")
    
    photo_count = 0
    
    def photo_callback(photo_path):
        nonlocal photo_count
        photo_count += 1
        print(f"ğŸ“¸ ç¬¬ {photo_count} å¼ åè„‘å‹ºç…§ç‰‡å·²æ‹æ‘„: {photo_path}")
    
    try:
        detector.start_detection(photo_callback)
        print(f"\nğŸ‰ æ£€æµ‹å®Œæˆï¼")
        print(f"ğŸ“Š ç»Ÿè®¡ç»“æœï¼š")
        print(f"   - å…±æ‹æ‘„äº† {photo_count} å¼ åè„‘å‹ºç…§ç‰‡")
        print(f"   - ç³»ç»ŸæˆåŠŸé¿å…äº†æ‹æ‘„æ­£è„¸")
        print(f"   - æ‰€æœ‰ç…§ç‰‡éƒ½ä¿å­˜åœ¨ photos/ ç›®å½•ä¸­")
        return True
    except Exception as e:
        print(f"æ£€æµ‹è¿‡ç¨‹ä¸­å‡ºé”™: {e}")
        return False
    finally:
        detector.stop_detection()

def main():
    """ä¸»å‡½æ•°"""
    print("æ”¹è¿›çš„åè„‘å‹ºæ£€æµ‹æ‹ç…§ç³»ç»Ÿ - æµ‹è¯•ç¨‹åº")
    
    if test_improved_detection():
        print("\nğŸ‰ æµ‹è¯•æˆåŠŸï¼")
        print("ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨æ”¹è¿›çš„åè„‘å‹ºæ£€æµ‹åŠŸèƒ½")
        print("\nğŸ“ ä¸»è¦æ”¹è¿›ï¼š")
        print("1. âœ… æ™ºèƒ½æ­£è„¸æ£€æµ‹ - æ£€æµ‹åˆ°æ­£è„¸æ—¶ä¸æ‹ç…§")
        print("2. âœ… å£°éŸ³æç¤º - æ‹ç…§æ—¶æ’­æ”¾æç¤ºéŸ³")
        print("3. âœ… è§†è§‰åé¦ˆ - å®æ—¶æ˜¾ç¤ºæ£€æµ‹çŠ¶æ€")
        print("4. âœ… å†·å´æœºåˆ¶ - æ£€æµ‹åˆ°æ­£è„¸å3ç§’å†…ä¸æ‹ç…§")
    else:
        print("\nâŒ æµ‹è¯•å¤±è´¥")
        print("è¯·æ£€æŸ¥ç³»ç»Ÿé…ç½®å’Œæ‘„åƒå¤´æƒé™")

if __name__ == "__main__":
    main()
